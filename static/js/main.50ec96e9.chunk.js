(this["webpackJsonpchat-react"]=this["webpackJsonpchat-react"]||[]).push([[0],{154:function(e,a,t){e.exports=t(232)},229:function(e,a){},232:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(8),s=t.n(l),c=t(11),o=t.n(c),i=t(15),u=t(12),m=t.n(u),d=t(266),p=t(262),g=t(263),E=t(78),f=t(261),h=t(264),v=t(281),b=t(135),w=t.n(b),S=function(e){var a=e.letters,t=e.isOnline;return r.a.createElement(w.a,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:t?r.a.createElement("span",{style:{backgroundColor:"#44b700",width:10,height:10,borderRadius:"50%"}}):null},r.a.createElement(v.a,null,a?a.toUpperCase():null))},O=function(e){var a=e.msg,t=e.onlineUsers,n=a.user,l=a.message,s=a.date,c=n.email,o=new Date(s),i=t.findIndex((function(e){return e.userId===n._id})),u="".concat(o.getFullYear(),"-").concat(o.getMonth()<10?"0".concat(o.getMonth()):o.getMonth(),"-").concat(o.getDate()<10?"0".concat(o.getDate()):o.getDate(),", \n\t").concat(o.getHours()<10?"0".concat(o.getHours()):o.getHours(),":").concat(o.getMinutes()<10?"0".concat(o.getMinutes()):o.getMinutes(),":").concat(o.getSeconds()<10?"0".concat(o.getSeconds()):o.getSeconds());return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{alignItems:"flex-start"},r.a.createElement(p.a,null,r.a.createElement(S,{letters:"".concat(c[0]).concat(c[1]),isOnline:-1!==i})),r.a.createElement(g.a,{primary:r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(E.a,{component:"span",variant:"body2",color:"textPrimary"},c),r.a.createElement(E.a,{component:"span",variant:"body2",color:"textPrimary"},u)),secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{component:"span",variant:"body2",color:"textPrimary"}),l)})),r.a.createElement(h.a,{variant:"inset",component:"li"}))},y=t(17),j=t(265),x=function(){return r.a.createElement("div",{style:{display:"flex",padding:"10px"}},r.a.createElement("div",null,r.a.createElement(j.a,{variant:"circle",width:40,height:40})),r.a.createElement("div",{style:{width:"100%",paddingLeft:"10px"}},r.a.createElement("div",{style:{paddingBottom:"10px"}},r.a.createElement(j.a,{variant:"rect",width:150,height:20})),r.a.createElement(j.a,{variant:"rect",width:"100%",height:50})))},C=t(268),_=t(267),U=t(76),k=t.n(U),A=function(e){e?m.a.defaults.headers.common.Authorization="Bearer ".concat(e):delete m.a.defaults.headers.common.Authorization},L=function(){return function(e){var a;return o.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.token&&A(localStorage.token),t.prev=1,t.next=4,o.a.awrap(m.a.get("/users/me"));case 4:a=t.sent,e({type:"USER_LOGIN_SUCCESS",payload:a.data}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e({type:"USER_LOGIN_FAIL"});case 11:case"end":return t.stop()}}),null,null,[[1,8]])}},I=Object(y.b)((function(e){return{messages:e.messages}}),{getMessages:function(e){return function(a){var t,n;return o.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!e){r.next=8;break}return r.next=4,o.a.awrap(m.a.get("/messages?page=".concat(e)));case 4:t=r.sent,a({type:"MESSAGES_LOAD_MORE_SUCCESS",payload:t.data}),r.next=12;break;case 8:return r.next=10,o.a.awrap(m.a.get("/messages"));case 10:n=r.sent,a({type:"MESSAGES_FETCH_SUCCESS",payload:n.data});case 12:r.next=17;break;case 14:r.prev=14,r.t0=r.catch(0),a({type:"MESSAGES_FETCH_FAIL"});case 17:case"end":return r.stop()}}),null,null,[[0,14]])}},updateOnlineUsers:function(e){return function(a){return o.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"ONLINE_USERS",payload:e});case 1:case"end":return t.stop()}}))}}})((function(e){var a=e.getMessages,t=e.messages,l=e.user,s=e.updateOnlineUsers,c=t.items,u=t.total,p=t.page,g=Object(n.useState)(!1),E=Object(i.a)(g,2),h=E[0],v=E[1],b=Object(n.useState)(!1),w=Object(i.a)(b,2),S=w[0],y=w[1],j=l.isAuthenticated,U=l._id,A=l.onlineUsers;Object(n.useEffect)((function(){v(!0),o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(a());case 2:v(!1);case 3:case"end":return e.stop()}}))}),[]),Object(n.useEffect)((function(){var e=k()(m.a.defaults.baseURL);e.on("connect",(function(){e.emit("online user",j?U:null)})),e.on("online users",(function(e){s(e.online)}))}),[l.isAuthenticated]);return r.a.createElement(d.a,null,h?r.a.createElement(r.a.Fragment,null,r.a.createElement(x,null),r.a.createElement(x,null),r.a.createElement(x,null),r.a.createElement(x,null),r.a.createElement(x,null)):r.a.createElement(r.a.Fragment,null,c.length<u?r.a.createElement(f.a,null,S?r.a.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"center"}},r.a.createElement(_.a,{color:"secondary"})):r.a.createElement(C.a,{variant:"contained",color:"primary",style:{margin:"0 auto"},onClick:function(){return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.next=3,o.a.awrap(a(p+1));case 3:y(!1);case 4:case"end":return e.stop()}}))}},"Get older")):null,c.length>0&&c.map((function(e){return r.a.createElement(O,{key:e._id,msg:e,onlineUsers:A})}))))})),R=t(275),N=t(274),F=t(138),M=Object(y.b)((function(e){var a=e.user;return{isAuthenticated:a.isAuthenticated,_id:a._id}}),{userLogOut:function(e){return function(a){k()(m.a.defaults.baseURL).emit("user logout",e),a({type:"USER_LOGOUT"})}}})((function(e){var a=e.isAuthenticated,t=e.userLogOut,n=e._id;return r.a.createElement(r.a.Fragment,null,a&&r.a.createElement(C.a,{variant:"outlined",color:"secondary",onClick:function(){return t(n)}},"Log out"))})),W=t(94),T=Object(y.b)((function(e){return{isAuthenticated:e.user.isAuthenticated}}))((function(e){var a=e.setOpenLoginPopup,t=e.isAuthenticated;return r.a.createElement(r.a.Fragment,null,!t&&r.a.createElement(C.a,{variant:"outlined",color:"primary",onClick:function(){return a(!0)}},"login"))})),G=t(280),q=t(139),D=t.n(q),P=t(278),z=t(273),B=t(277),H=t(61),Z=t(23),V=function(e,a){var t=Object(n.useState)({}),r=Object(i.a)(t,2),l=r[0],s=r[1],c=Object(n.useState)({}),o=Object(i.a)(c,2),u=o[0],m=o[1],d=Object(n.useState)(!1),p=Object(i.a)(d,2),g=p[0],E=p[1];return Object(n.useEffect)((function(){0===Object.keys(u).length&&g&&e()}),[u]),{handleChange:function(e,a){s((function(t){return Object(Z.a)({},t,Object(H.a)({},e,a))})),m((function(a){return Object(Z.a)({},a,Object(H.a)({},e,null))}))},handleSubmit:function(e){e.preventDefault(),m(a(l)),E(!0)},setServerErrors:function(e){m((function(a){return Object(Z.a)({},a,{},e)}))},values:l,errors:u}},J=t(271),Y=t(270),$=t(269),K=t(272),Q=Object(F.a)((function(e){return{paper:{display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}})),X=Object(y.b)(null,{loadUser:L})((function(e){var a=Object(n.useState)(!1),t=Object(i.a)(a,2),l=t[0],s=t[1],c=Q(),u=V((function(){var a,t,n,r,l;return o.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return s(!0),a=g.email,t=g.password,c.prev=2,c.next=5,o.a.awrap(m.a.post("/auth",{email:a,password:t}));case 5:n=c.sent,r=n.data,l=r.token,localStorage.setItem("token",l),e.loadUser(),s(!1),c.next=18;break;case 13:c.prev=13,c.t0=c.catch(2),console.log(c.t0),h({email:c.t0.message}),s(!1);case 18:case"end":return c.stop()}}),null,null,[[2,13]])}),(function(e){var a={};return e.email||(a.email="Required"),e.password||(a.password="Required"),e.email&&!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.email)&&(a.email="Email is not valid"),a})),d=u.handleChange,p=u.handleSubmit,g=u.values,f=u.errors,h=u.setServerErrors;return r.a.createElement(r.a.Fragment,null,r.a.createElement($.a,null,r.a.createElement("div",{className:c.paper},r.a.createElement(v.a,{className:c.avatar}),r.a.createElement(E.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement("form",{className:c.form,noValidate:!0,onSubmit:p},r.a.createElement(Y.a,{fullWidth:!0,error:!!f.email},r.a.createElement(B.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",onChange:function(e){return d(e.target.name,e.target.value)},label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,error:!!f.email,value:g.email?g.email:""}),f.email&&r.a.createElement(J.a,null,f.email)),r.a.createElement(Y.a,{fullWidth:!0,error:!!f.password},r.a.createElement(B.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",error:!!f.password,onChange:function(e){return d(e.target.name,e.target.value)},autoComplete:"current-password",value:g.password?g.password:""}),f.password&&r.a.createElement(J.a,null,f.password))))),r.a.createElement(K.a,null,l?r.a.createElement(_.a,null):r.a.createElement(C.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:c.submit,onClick:p,size:"large"},"Sign In")))})),ee=t(69),ae=Object(F.a)((function(e){return{paper:{display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}})),te=Object(ee.a)(null,{loadUser:L})((function(e){var a=Object(n.useState)(!1),t=Object(i.a)(a,2),l=t[0],s=t[1],c=ae(),u=V((function(){var a,t,n,r,l;return o.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return s(!0),a=g.email,t=g.password,c.prev=2,c.next=5,o.a.awrap(m.a.post("/users",{email:a,password:t}));case 5:n=c.sent,r=n.data,l=r.token,s(!1),localStorage.setItem("token",l),e.loadUser(),c.next=18;break;case 13:c.prev=13,c.t0=c.catch(2),console.log(c.t0),h({email:c.t0.message}),s(!1);case 18:case"end":return c.stop()}}),null,null,[[2,13]])}),(function(e){var a={};return e.email||(a.email="Required"),e.email&&!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.email)&&(a.email="Email is not valid"),e.password||(a.password="Required"),e.repeat_password||(a.repeat_password="Required"),e.password&&e.repeat_password&&e.password!==e.repeat_password&&(a.password="Passwords are different",a.repeat_password="Passwords are different"),a})),d=u.handleChange,p=u.handleSubmit,g=u.values,f=u.errors,h=u.setServerErrors;return r.a.createElement(r.a.Fragment,null,r.a.createElement($.a,null,r.a.createElement("div",{className:c.paper},r.a.createElement(v.a,{className:c.avatar}),r.a.createElement(E.a,{component:"h1",variant:"h5"},"Sign Up"),r.a.createElement("form",{className:c.form,noValidate:!0,onSubmit:p},r.a.createElement(Y.a,{fullWidth:!0,error:!!f.email},r.a.createElement(B.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",onChange:function(e){return d(e.target.name,e.target.value)},label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,error:!!f.email,value:g.email?g.email:""}),f.email&&r.a.createElement(J.a,null,f.email)),r.a.createElement(Y.a,{fullWidth:!0,error:!!f.password},r.a.createElement(B.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",error:!!f.password,onChange:function(e){return d(e.target.name,e.target.value)},autoComplete:"current-password",value:g.password?g.password:""}),f.password&&r.a.createElement(J.a,null,f.password)),r.a.createElement(Y.a,{fullWidth:!0,error:!!f.repeat_password},r.a.createElement(B.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"repeat_password",label:"Repeat password",type:"password",id:"repeat_password",error:!!f.repeat_password,onChange:function(e){return d(e.target.name,e.target.value)},autoComplete:"current-password",value:g.repeat_password?g.repeat_password:""}),f.repeat_password&&r.a.createElement(J.a,null,f.repeat_password))))),r.a.createElement(K.a,null,l?r.a.createElement(_.a,null):r.a.createElement(C.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:c.submit,size:"large",onClick:p},"Sign Up")))})),ne=Object(y.b)((function(e){return{isAuthenticated:e.user.isAuthenticated}}))((function(e){var a=e.open,t=e.setOpen,l=e.isAuthenticated,s=r.a.useState(0),c=Object(i.a)(s,2),o=c[0],u=c[1];return Object(n.useEffect)((function(){l&&t(!1)}),[l]),r.a.createElement(G.a,{open:a,onClose:function(){return t(!1)},"aria-labelledby":"auth-tabs-title"},r.a.createElement(D.a,{position:"static"},r.a.createElement(P.a,{value:o,onChange:function(e,a){return u(a)},"aria-label":"auth tabs",centered:!0},r.a.createElement(z.a,{label:"Sign In",id:"signIn","aria-controls":"signIn-tab"}),r.a.createElement(z.a,{label:"Sign Up",id:"signUp","aria-controls":"signUp-tab"}))),0===o&&r.a.createElement(X,null),1===o&&r.a.createElement(te,null))})),re=Object(F.a)((function(e){return{root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper,margin:"0 auto",height:"100%"},paper:{paddingBottom:50,boxShadow:"none"},appBar:{top:"auto",bottom:0,width:"100%",maxWidth:360,left:"50%",marginLeft:"-180px"},topToolbar:{flexGrow:1,display:"flex",alignItems:"center"},topToolbarText:{fontWeight:700,marginLeft:"10px"}}})),le=Object(y.b)((function(e){return{user:e.user}}))((function(e){var a=re(),t=Object(n.useState)(!1),l=Object(i.a)(t,2),s=l[0],c=l[1],u=e.user,d=e.isUserLoading,p=u.email,g=u.isAuthenticated,E=Object(n.useRef)(null);Object(n.useEffect)((function(){E.current.scrollIntoView({behavior:"smooth",block:"start"})}),[]);var f=V((function(){var e,a;return o.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=b.message,t.prev=1,t.next=4,o.a.awrap(m.a.post("/messages",{message:e}));case 4:a=t.sent,console.log(a),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),t.t0.response&&t.t0.response.data?O({message:t.t0.response.data}):O({message:t.t0.message});case 11:case"end":return t.stop()}}),null,null,[[1,8]])}),(function(e){var a={};return e.message||(a.message="Required"),a})),h=f.handleChange,v=f.handleSubmit,b=f.values,w=f.errors,O=f.setServerErrors;return r.a.createElement("div",{className:a.root},r.a.createElement(N.a,{position:"sticky",style:{flexGrow:1},color:"inherit"},r.a.createElement(R.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:a.topToolbar},d?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(j.a,{variant:"circle",width:40,height:40})),r.a.createElement("div",null,r.a.createElement(j.a,{variant:"rect",width:150,height:20}))):g?r.a.createElement(r.a.Fragment,null,r.a.createElement(S,{letters:"".concat(p[0]).concat(p[1]),isOnline:!0}),r.a.createElement("div",{className:a.topToolbarText},p)):r.a.createElement(r.a.Fragment,null,r.a.createElement(S,{isOnline:!1}),r.a.createElement("div",{className:a.topToolbarText},"Please, Login"))),!d&&r.a.createElement(r.a.Fragment,null,r.a.createElement(M,null),r.a.createElement(T,{setOpenLoginPopup:c}))))),r.a.createElement(W.a,{square:!0,className:a.paper},r.a.createElement(I,{user:u}),r.a.createElement("div",{ref:E})),r.a.createElement(N.a,{position:"fixed",color:"inherit",className:a.appBar},r.a.createElement(R.a,null,r.a.createElement(Y.a,{fullWidth:!0,error:!!w.message,style:{marginRight:"5px"}},r.a.createElement(B.a,{id:"message",placeholder:"Your message",multiline:!0,rowsMax:"2",error:!!w.message,value:b.message?b.message:"",onChange:function(e){return h("message",e.target.value)}}),w.message&&r.a.createElement(J.a,null,w.message)),r.a.createElement(C.a,{variant:"contained",color:"primary",onClick:v},"Send"))),r.a.createElement(ne,{open:s,setOpen:c}))})),se=t(33),ce=t(140),oe=t(141),ie={isAuthenticated:!1,onlineUsers:[]},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"USER_LOGIN_SUCCESS":return Object(Z.a)({},e,{isAuthenticated:!0},n);case"ONLINE_USERS":return Object(Z.a)({},e,{onlineUsers:n});case"USER_LOGOUT":case"USER_LOGIN_FAIL":return localStorage.removeItem("token"),Object(Z.a)({},ie,{isAuthenticated:!1})}return e},me=t(96),de={total:0,page:1,items:[]},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"MESSAGES_FETCH_SUCCESS":return Object(Z.a)({},e,{},n,{items:n.items.reverse()});case"MESSAGES_LOAD_MORE_SUCCESS":return Object(Z.a)({},e,{total:n.total,page:n.page,items:[].concat(Object(me.a)(n.items.reverse()),Object(me.a)(e.items))})}return e},ge=Object(se.combineReducers)({user:ue,messages:pe}),Ee=t(276),fe=Object(se.createStore)(ge,Object(ce.composeWithDevTools)(Object(se.applyMiddleware)(oe.a)));m.a.defaults.baseURL="https://radiant-taiga-91549.herokuapp.com",localStorage.token&&A(localStorage.token);var he=function(){var e=Object(n.useState)(!0),a=Object(i.a)(e,2),t=a[0],l=a[1];return Object(n.useEffect)((function(){o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(fe.dispatch(L()));case 2:l(!1);case 3:case"end":return e.stop()}}))}),[]),r.a.createElement(y.a,{store:fe},r.a.createElement("div",{className:"App"},r.a.createElement(Ee.a,null),r.a.createElement(le,{isUserLoading:t})))};s.a.render(r.a.createElement(he,null),document.getElementById("root"))}},[[154,1,2]]]);
//# sourceMappingURL=main.50ec96e9.chunk.js.map